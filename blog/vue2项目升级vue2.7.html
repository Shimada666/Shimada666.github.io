<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue2项目升级Vue2.7 | 鼠鼠屋 🐭</title>
    <meta name="description" content="一些简单的东西">
    <link rel="stylesheet" href="/assets/style.6b537e8f.css">
    <link rel="modulepreload" href="/assets/app.35f5d916.js">
    <link rel="modulepreload" href="/assets/blog_vue2项目升级vue2.7.md.5716ae91.lean.js">
    
    <meta name="twitter:title" content="Vue2项目升级Vue2.7 | 鼠鼠屋 🐭">
  <meta property="og:title" content="Vue2项目升级Vue2.7 | 鼠鼠屋 🐭">
  </head>
  <body>
    <div id="app"><div><!--[--><div class="theme"><header class="nav-bar" data-v-1b98150f><div class="sidebar-button" data-v-1b98150f><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="鼠鼠屋 🐭, back to home" data-v-1b98150f data-v-128f6faf><!----> 鼠鼠屋 🐭</a><div class="flex-grow" data-v-1b98150f></div><div class="nav" data-v-1b98150f><nav class="nav-links" data-v-1b98150f data-v-c6c99ff2><!--[--><div class="item" data-v-c6c99ff2><div class="nav-link" data-v-c6c99ff2 data-v-25960e74><a class="item" href="/" data-v-25960e74>主页 <!----></a></div></div><div class="item" data-v-c6c99ff2><div class="nav-link" data-v-c6c99ff2 data-v-25960e74><a class="item" href="/tags" data-v-25960e74>分类 <!----></a></div></div><div class="item" data-v-c6c99ff2><div class="nav-link" data-v-c6c99ff2 data-v-25960e74><a class="item isExternal" href="https://github.com/Shimada666" target="_blank" rel="noopener noreferrer" data-v-25960e74>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-25960e74><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-ef7edbf4><nav class="nav-links nav" data-v-ef7edbf4 data-v-c6c99ff2><!--[--><div class="item" data-v-c6c99ff2><div class="nav-link" data-v-c6c99ff2 data-v-25960e74><a class="item" href="/" data-v-25960e74>主页 <!----></a></div></div><div class="item" data-v-c6c99ff2><div class="nav-link" data-v-c6c99ff2 data-v-25960e74><a class="item" href="/tags" data-v-25960e74>分类 <!----></a></div></div><div class="item" data-v-c6c99ff2><div class="nav-link" data-v-c6c99ff2 data-v-25960e74><a class="item isExternal" href="https://github.com/Shimada666" target="_blank" rel="noopener noreferrer" data-v-25960e74>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-25960e74><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-ef7edbf4><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#项目简介">项目简介</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#踩坑">踩坑</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#基础依赖替换">基础依赖替换</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#替换-composition-api-相关代码">替换 composition-api 相关代码</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#更新-vite-config-ts">更新 vite.config.ts</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#升级-vue-echarts">升级 vue-echarts</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#升级-vueuse">升级 vueuse</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#总结">总结</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-0df8c27e><div class="container" data-v-0df8c27e><!--[--><!--[--><!----><!--]--><!--[--><div class="page-header style-text" data-v-cb811eac><div class="post-heading" data-v-cb811eac><div class="tags" data-v-cb811eac><!--[--><a class="tag" title="前端" data-v-cb811eac>前端</a><a class="tag" title="vue" data-v-cb811eac>vue</a><!--]--></div><h1 data-v-cb811eac>Vue2项目升级Vue2.7</h1><div class="subheading" data-v-cb811eac></div><span class="meta" data-v-cb811eac>Last Updated on 2022-07-25</span></div></div><!--]--><!--]--><div style="position:relative;" class="content" data-v-0df8c27e><div><p>就在七月初，vue 发布了 vue2.7 版本。这个版本带来了 vue3 的 composition-api 与 script setup 等特性， 让无法迁移 vue3 的 vue2 用户也可以用上新特性，使开发更便捷。</p><p>当然，vue2.7 升级也是有一些成本的，如某些插件需要更新版本、如果原先使用了 @vue/composition-api, unplugin-vue2-script-setup 等插件， 还需要对代码做相应的改造，接下来介绍一下我们该如何改造。</p><h2 id="项目简介" tabindex="-1">项目简介 <a class="header-anchor" href="#项目简介" aria-hidden="true">#</a></h2><p>我的项目是一个 2020 年 4 月创建的一个项目，不算新但也不算老，使用 vue + ts 开发。在后续经历过几次升级， 如引入 composition-api、unplugin-vue2-script-setup、vite 等插件，使用 vue3 的方式来开发项目。但是使用起来不知道是不是姿势问题， 还是有一些 bug, 因此这次打算升级到原生就支持这些的 vue2.7 版本，来彻底解决这些问题。</p><h2 id="踩坑" tabindex="-1">踩坑 <a class="header-anchor" href="#踩坑" aria-hidden="true">#</a></h2><h3 id="基础依赖替换" tabindex="-1">基础依赖替换 <a class="header-anchor" href="#基础依赖替换" aria-hidden="true">#</a></h3><p>第一步，当然是上网查找资料查看前人总结的升级攻略。不过 vue2.7 刚出来，写指南的人也并不多，那我们就根据官网的指示， 把依赖替换。 由于我们的项目引入了 composition-api 等插件，所以我们先做基础替换</p><ul><li><code>vue</code> -&gt; 2.7.5 升级最新版本</li><li><code>unplugin-vue2-script-setup</code> -&gt; 删除（vue2.7提供了 script setup 功能）</li><li><code>vite-plugin-vue2</code> -&gt; 替换为官方提供的 <code>@vitejs/plugin-vue2</code></li><li><code>vue-template-compiler</code> -&gt; 根据官方手册，删除</li><li><code>@vue/composition-api</code> -&gt; 删除</li></ul><p>做完之后，删除 lock 文件与 node_modules，重新安装依赖。</p><h3 id="替换-composition-api-相关代码" tabindex="-1">替换 composition-api 相关代码 <a class="header-anchor" href="#替换-composition-api-相关代码" aria-hidden="true">#</a></h3><p>第二步，我们删除代码中引用 <code>@vue/composition-api</code> 的部分，并且把 <code>@vue/composition-api</code> 全局替换为 <code>vue</code>，因为这些内容 vue2.7 中有。</p><h3 id="更新-vite-config-ts" tabindex="-1">更新 vite.config.ts <a class="header-anchor" href="#更新-vite-config-ts" aria-hidden="true">#</a></h3><p>第三步，我们需要更新 <code>vite.config.ts</code> 的配置。更新很简单。原先使用了 <code>vite-plugin-vue2</code>、 <code>unplugin-vue2-script-setup/vite</code> 这两个依赖，我们把相关代码都删除， 然后引入 <code>@vitejs/plugin-vue2</code>。最终代码像这样。</p><div class="language-typescript"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span>
<span class="token keyword">import</span> WindiCSS <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-windicss&#39;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue2&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;path&#39;</span>
<span class="token keyword">import</span> env <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-env-compatible&#39;</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">WindiCSS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      preflight<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">env</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;@&#39;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  server<span class="token operator">:</span> <span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">8081</span><span class="token punctuation">,</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&#39;/api&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">&#39;http://localhost:8080&#39;</span><span class="token punctuation">,</span>
        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  css<span class="token operator">:</span> <span class="token punctuation">{</span>
    preprocessorOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      scss<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">additionalData</span> <span class="token punctuation">(</span>source<span class="token punctuation">,</span> fp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// All scss files ending with imports.scss</span>
          <span class="token comment">// will not re-import additionalData</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&#39;.scss&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> source
          <span class="token comment">// Use additionalData from legacy nuxt scss options</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@import &quot;@/assets/style/share.scss&quot;; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="升级-vue-echarts" tabindex="-1">升级 vue-echarts <a class="header-anchor" href="#升级-vue-echarts" aria-hidden="true">#</a></h3><p>做完这些，我们发现项目使用到了新语法的页面会渲染两次。经过排查，发现是引入的 <code>vue-echarts(v6.0.2)</code> 插件有问题。</p><p>既然发现插件有问题，那么第四步，就是修复问题。我们到 vue-echarts 的 github 页面查看，发现已经有人提出了 issue，且作者给出了解决办法： 升级到 v6.2.0 版本。我们尝试升级之后，发现问题解决。查看原因是因为旧版本 vue-echarts 的依赖 vue-demi 指定了 ^0.12.x 的版本， 而 vue-demi 需要 0.13.x 才开始支持。</p><h3 id="升级-vueuse" tabindex="-1">升级 vueuse <a class="header-anchor" href="#升级-vueuse" aria-hidden="true">#</a></h3><p>做完这些之后，项目能跑起来了，但是测试发现还是有些问题。排查到是使用了 <code>vueuse</code> 的 <code>useVModel</code> 报错了。那么第五步，上github 查找 issue，发现已经有人提过且 pr 了。艾特了作者请求合并 pr，作者很快合并且 release 了新版本 v8.9.3，升级版本后成功解决问题</p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h2><p>至此，我们的项目就成功跑起来了。总的升级时间零零散散花了两天，主要还是排查问题上多耗费了些时间。但对于升级后的开发效率，这些都是值得的， vue2.7 + vite 的开发方式能极大提升开发效率与体验，让开发不再痛苦，对于有时间的朋友，非常推荐将项目升级到 vue2.7 来。</p></div></div><footer class="page-footer" data-v-0df8c27e data-v-1bc42688><div class="edit" data-v-1bc42688><div class="edit-link" data-v-1bc42688 data-v-60fa6c8f><!----></div></div><div class="updated" data-v-1bc42688><p class="last-updated" data-v-1bc42688 data-v-061fcb47><span class="prefix" data-v-061fcb47>Last Updated:</span><span class="datetime" data-v-061fcb47></span></p></div></footer><!----><!--[--><!--[--><!--]--><!--[--><!----><!--]--><!--]--></div></main></div><!----><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blog_buildblog.md\":\"19a948f3\",\"blog_paindiary.md\":\"7032dd94\",\"blog_springboot项目规范.md\":\"85b142d1\",\"blog_vue2项目迁移vite.md\":\"978a369d\",\"blog_vue2项目升级vue2.7.md\":\"5716ae91\",\"blog_使用mockito帮助单测.md\":\"867fc41c\",\"blog_初探plantuml.md\":\"e2db8752\",\"blog_容器分析工具.md\":\"a85f891e\",\"blog_民生银行全币种信用卡如何还款.md\":\"e7acdad1\",\"index.md\":\"e087fa1a\",\"tags.md\":\"eaec04f0\"}")</script>
    <script type="module" async src="/assets/app.35f5d916.js"></script>
    
  </body>
</html>